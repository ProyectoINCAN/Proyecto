{%extends 'base/base2.html' %}
{% load static %}

{% block extrajs %}
<script>
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
};

    $(document).ready(function() {
        $('#cancelar').click(function() {
        console.log("llega al js");
            BootstrapDialog.show({
            //title: 'Tipo de Cancelación de agenda',
            title: 'Cancelación de agenda',
            //message: 'Seleccione tipo de cancelación',
            message: '¿Seguro que desea cancelar la agenda?',
            draggable: true,
            buttons: [/*{
                label: 'Siguiente fecha',
                cssClass: 'btn-primary',
                icon: 'fa fa-step-forward',
                action: function(dialog){
                    dialog.close();
                    var csrftoken = getCookie('csrftoken');
                    console.log("token", csrftoken);
                    $.ajax({
                         type:"POST",
                         url:"{% url 'agendamientos:agenda_cancelar' agenda.id %}",
                         data: {
                                'tipo': 2,
                                'csrfmiddlewaretoken': csrftoken
                                },
                         success: function(data){
                            console.log("llega al success");
                            console.log("data", data );
                            console.log("data", $.parseJSON(data)[0].pk );
                            window.location="/agendamientos/agenda/"+$.parseJSON(data)[0].pk;
                         }
                    });
                    return false;
                }
            },*/ {
                //label: 'Última fecha',
                label: 'Cancelar',
                // no title as it is optional
                cssClass: 'btn-primary',
                icon: 'fa fa-fast-forward',
                action: function(dialog){
                    dialog.close();
                    var csrftoken = getCookie('csrftoken');
                    console.log("token", csrftoken);
                    $.ajax({
                         type:"POST",
                         url:"{% url 'agendamientos:agenda_cancelar' agenda.id %}",
                         data: {
                                'tipo': 1,
                                'csrfmiddlewaretoken': csrftoken
                                },
                         success: function(data){
                            console.log("llega al success");
                            console.log("data", data );
                            console.log("data", $.parseJSON(data)[0].pk );
                            window.location="/agendamientos/agenda/"+$.parseJSON(data)[0].pk;
                         }
                    });
                    return false;
                }
            }, ]
        });

    }
    );

    });

</script>
{% endblock %}

{%block content %}


<form method="POST" class="form-horizontal" id="form">
<div class="row">
        <h2>Agenda</h2>
<div class="col-lg-8 col-sm-12">
        {% csrf_token %}
        {{form.media}}
        <div class="form-group">
			<label class="control-label col-lg-2 col-sm-4">Fecha</label>
			<div class="col-lg-3 col-sm-4">
				<input type="text" class="form-control text-center" id="fecha" name ="fecha" value="{{agenda.fecha}}" required="required"  disabled="disabled" data-inputmask="'alias': 'date'" placeholder="dd/mm/yyyy">
			</div>
		</div>

        <div class="form-group">
			<label class="control-label col-lg-2 col-sm-4">Médico</label>
			<div class="col-sm-6">
				<input type="text" class="form-control text-left" id="medico" name ="medico" value="{{agenda.medico}}"  disabled="disabled">
			</div>
		</div>

        <div class="form-group">
			<label class="control-label col-lg-2 col-sm-4">Turno</label>
			<div class="col-lg-3 col-sm-4">
				<input type="text" class="form-control text-left" id="turno" name ="turno" value="{{agenda.turno}}"  disabled="disabled">
			</div>
		</div>
        <div class="form-group" align="center">
            <!--<a href="{% url 'agendamientos:agenda_cancelar' agenda.id %}" id="cancelar" class="btn btn-danger"><i class="fa fa-ban" aria-hidden="true"></i> Cancelar Agenda</a>-->
            <!--<a href="#" id="cancelar" class="btn btn-danger" onclick="confirmar();"><i class="fa fa-ban" aria-hidden="true"></i> Cancelar Agenda</a>-->
            <a id="cancelar" type="button" class="btn btn-danger" > <i class="fa fa-ban" aria-hidden="true"></i> Cancelar Agenda</a>
            <a href="{% url 'agendamientos:agenda_especialidad_medico' %}" id="salir" class="btn btn-default"><i class="fa fa-arrow-left" aria-hidden="true"></i> Salir</a>
        </div>

</div>
</div>

</div>
    </div>

</div>
</form>




<br>
<div class="panel panel-default">
    <div class="panel-heading">
		<b>Lista</b>
		<div class="btn-group pull-right">
            <a href="/agendamientos/agenda/{{agenda.id}}/nuevo" id="create" class="btn btn-default"><i class="fa fa-plus-square" aria-hidden="true"></i></i> Nuevo</a>
			</div>
		<div class="clearfix"></div>
	</div>

    <div class="table-responsive">
        <table class="table table-hover table-condensed table-bordered" >
            <!--<table class="table table-bordered">-->
            <thead>
                <tr>
                    <td>Nº</td>
                    <td>Ficha</td>
                    <td>Nombre y Apellido</td>
                    <td>Edad</td>
                    <td>Ciudad</td>
                    <td>Tel&eacute;fono</td>
                    <td>Observación</td>
                </tr>
            </thead>
            <tbody>
        {% if agenda_detalle %}
        {% for detalle in agenda_detalle %}
            <tr>
                <td>
                    <a href="/agendamientos/agenda/{{detalle.agenda.id}}/{{detalle.id}}/editar">{{ detalle.orden }}</a>
                </td>
                <td>{{detalle.paciente.nro_doc}}</td>
                <td>{{detalle.paciente}}</td>
                <td></td>
                <td>{{detalle.paciente.distrito.nombre}}</td>
                <td>{{detalle.paciente.telefono.numero}}</td>
                <td>{{detalle.confirmado}}</td>


            </tr>
        {% endfor %}

        {% else %}
        <h1>No hay registros de agendamientos</h1>

        {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock%}
